# 书签功能实现

## 概述

为 flowt 添加了完整的书签功能，允许用户收藏重要的流水线，提升使用体验和操作效率。

## 功能特性

### 1. 书签管理
- **添加/移除书签**: 在主界面按 `B` 键（大写）将当前选中的流水线添加到书签或从书签中移除
- **自动保存**: 书签操作会自动保存到配置文件 `~/.flowt/config.yml`
- **静默操作**: 书签切换无弹窗提示，操作更加流畅

### 2. 书签显示
- **视觉标识**: 被书签的流水线在第一列显示 `★` 标记
- **优先排序**: 在显示全部流水线时，被书签的流水线会排在前面
- **状态保持**: 书签状态在程序重启后保持

### 3. 书签筛选
- **切换显示**: 按 `b` 键（小写）在全部流水线和仅显示书签流水线之间切换
- **标题显示**: 界面标题会显示当前的筛选状态
  - `All Pipelines` - 显示所有流水线
  - `Pipelines (BOOKMARKED)` - 仅显示书签流水线
  - `Pipelines in 'GroupName' (BOOKMARKED)` - 在组内仅显示书签流水线

### 4. 简洁的表格界面
- **新增列**: 添加了书签标识列（★）
- **简洁设计**: 仅显示书签标识和流水线名称，界面更加清爽
- **统一样式**: 选中行使用浅灰色背景，与运行历史表格保持一致

## 配置文件

### 配置结构
```yaml
# 书签列表 - 可选，存储收藏的流水线名称
bookmarks:
  - "my-important-pipeline"
  - "production-deployment"
```

### 自动管理
- 书签通过界面操作自动添加和移除
- 配置文件会在每次书签操作后自动保存
- 支持手动编辑配置文件中的书签列表

## 按键操作

### 主界面新增按键
- `B` (大写): 添加/移除当前流水线的书签
- `b` (小写): 切换书签筛选模式

### 更新的帮助信息
```
Keys: j/k=move, Enter=run history, r=run, a=toggle filter, b=toggle bookmarks, B=bookmark, Ctrl+G=groups, /=search, q=back, Q=quit
```

## 技术实现

### 配置管理
- 扩展了 `Config` 结构体，添加 `Bookmarks []string` 字段
- 实现了 `saveConfig()` 函数用于保存配置
- 添加了书签操作函数：`AddBookmark()`, `RemoveBookmark()`, `ToggleBookmark()`, `IsBookmarked()`

### UI 组件增强
- 添加了全局书签函数变量
- 实现了 `SetBookmarkFunctions()` 函数用于设置书签回调
- 修改了 `updatePipelineTable()` 函数支持书签筛选和排序
- 简化了表格显示，仅保留书签列和名称列
- 统一了表格选中行的背景色样式（浅灰色）

### 数据流程
1. 主程序加载配置文件中的书签列表
2. 将书签操作函数传递给 UI 组件
3. UI 组件根据书签状态显示标识和排序
4. 用户操作触发书签切换和配置保存

## 使用场景

### 1. 收藏重要流水线
- 将生产环境部署流水线添加到书签
- 收藏经常使用的测试流水线
- 标记关键的 CI/CD 流水线

### 2. 快速访问
- 使用 `b` 键快速查看所有收藏的流水线
- 在大量流水线中快速定位重要项目
- 提高日常操作效率

### 3. 团队协作
- 团队成员可以分享重要流水线的书签配置
- 新成员可以快速了解项目中的关键流水线

## 兼容性

- 与现有功能完全兼容
- 不影响原有的筛选和搜索功能
- 可以与状态筛选（`a` 键）组合使用
- 支持在流水线组中使用书签功能

## 错误处理

- 配置文件保存失败时显示错误信息
- 书签操作异常时提供用户反馈
- 配置文件格式错误时程序仍能正常运行

## 性能优化

- 书签状态检查使用高效的查找算法
- 排序操作只在需要时执行
- 配置保存采用异步方式，不阻塞 UI

## 未来扩展

- 支持书签分组功能
- 添加书签导入/导出功能
- 支持书签的快捷键访问（如数字键）
- 添加书签的备注和标签功能 